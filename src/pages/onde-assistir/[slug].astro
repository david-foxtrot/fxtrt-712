---
import Layout from '../../layouts/Layout.astro';
import CardPartido from '../../components/CardPartido.astro';
import PartidoFicha from '../../components/PartidoFicha.astro'; // Usaremos esto en el futuro

// Importamos los datos de AMBAS tablas para generar todas las páginas
import equiposSerieA from '../../data/tabela-serie-a.json';
import equiposSerieB from '../../data/tabela-serie-b.json';
// Importamos los partidos de hoy para buscar el "Próximo Jogo"
import partidos from '../../data/partidos.json';

// Esta función le dice a Astro: "Crea una página para cada equipo que encuentres en estas listas"
export function getStaticPaths() {
  const todosOsEquipos = [...equiposSerieA, ...equiposSerieB];

  return todosOsEquipos.map(equipo => {
    // Aseguramos que el equipo tenga un slug antes de crear la página
    if (equipo.slug) {
      return {
        params: { slug: equipo.slug }, // La parte de la URL, ej: "flamengo"
        props: equipo, // Todos los datos del equipo para usar en la página
      };
    }
  }).filter(Boolean); // Filtramos cualquier entrada nula
}

// Recibimos los datos del equipo correspondiente a esta página
const equipo = Astro.props;

// Buscamos si este equipo tiene un partido programado para hoy
const proximoJogo = partidos.find(partido => 
  partido.timeCasa.sigla === equipo.sigla || partido.timeFora.sigla === equipo.sigla
);

// Determinamos la liga y la posición para mostrarlo en la página
const isSerieA = equiposSerieA.some(e => e.slug === equipo.slug);
const leagueName = isSerieA ? 'Brasileirão Série A' : 'Brasileirão Série B';
const positionInfo = `${equipo.pos}º lugar no ${leagueName}`;

// SEO Dinámico para cada página
const pageTitle = `Onde Assistir ${equipo.time} Ao Vivo | Próximos Jogos`;
const pageDescription = `Confira a posição atual do ${equipo.time} (${positionInfo}), e onde assistir o próximo jogo, horários e canais.`;
---

<Layout title={pageTitle} description={pageDescription}>
  <main class="container mx-auto p-4 max-w-2xl">
    
    <div class="flex items-center gap-4 my-8">
      <img src={equipo.logo} alt={`Logo do ${equipo.time}`} class="w-16 h-16" />
      <div>
        <h1 class="text-4xl font-bold text-white">{equipo.time}</h1>
        <p class="text-lg text-emerald-400 font-semibold">{positionInfo}</p>
      </div>
    </div>

    <div class="mt-12">
      <h2 class="text-2xl font-bold mb-4">Próximo Jogo</h2>
      {proximoJogo ? (
        <div class="bg-gray-800/50 rounded-lg">
          <CardPartido {...proximoJogo} />
          <div class="p-4 text-center">
            <a 
              href="#"
              target="_blank" 
              rel="noopener noreferrer"
              class="inline-block bg-emerald-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-emerald-600 transition-colors w-full md:w-auto"
            >
              Assinar Premiere (Exemplo de Afiliado)
            </a>
          </div>
        </div>
      ) : (
        <div class="bg-gray-800/50 rounded-lg p-8 text-center text-gray-400">
          <p>Nenhum próximo jogo agendado para hoje.</p>
        </div>
      )}
    </div>

    <div class="mt-12">
        <h2 class="text-2xl font-bold mb-4">Próximos Jogos</h2>
        <div class="bg-gray-800/50 rounded-lg p-8 text-center text-gray-400">
          <p>(Funcionalidade para o futuro...)</p>
        </div>
      </div>
  
      <div class="mt-12">
        <h2 class="text-2xl font-bold mb-4">Últimos Resultados</h2>
        <div class="bg-gray-800/50 rounded-lg p-8 text-center text-gray-400">
          <p>(Funcionalidade para o futuro...)</p>
        </div>
      </div>

  </main>
</Layout>